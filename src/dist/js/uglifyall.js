let restaurants,neighborhoods,cuisines;var map,markers=[];console.log("main.js"),window.addEventListener("load",e=>{console.log("load"),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{console.log("fetchNeighborhoods"),DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1})}),fetchCuisines=(()=>{updateRestaurants(),DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})});let selectedRestaurants={};updateRestaurants=(()=>{console.log("updateRestaurants");const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,a=t.selectedIndex,n=e[s].value,o=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})});var i,coll=document.getElementsByClassName("collapsible");for(i=0;i<coll.length;i++)coll[i].addEventListener("click",function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"});var elementCollapsable=document.getElementById("collapsible");let idIntersectingElement;elementCollapsable.addEventListener("click",()=>{initMap(),addMarkersToMap()}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()});var io=new IntersectionObserver(e=>{console.log("iointersect"),e.forEach(e=>{if(e.isIntersecting){let t=e.target.childNodes[0].id,s=t.replace(/^\D+/g,"");s=Number(s),idIntersectingElement=s,console.log("load image from intersect:",res.restaurants[s-1]),loadImage(res.restaurants[s-1],t),io.unobserve(e.target)}})});changeFavRestaurantBorder=((e,t)=>{let s=document.querySelectorAll("#restaurants-list li");e?(console.log("fav",s),s[t].style.borderColor="#c22c2c"):(console.log("else",s),s[t].style.borderColor="#ccc")}),getRestaurantfavStatus=(e=>fetch(`http://localhost:1337/restaurants/${e}`).then(e=>e.json()).then(e=>e.is_favorite)),createRestaurantHTML=((e,t)=>{const s=document.createElement("li");io.observe(s);let a=document.createElement("img");a.className="restaurant-img",a.id="image"+e.id,s.append(a);const n=document.createElement("h2");n.innerHTML=e.name,s.append(n);const o=document.createElement("p");o.innerHTML=e.neighborhood,s.append(o);const r=document.createElement("p");r.innerHTML=e.address,s.append(r);const l=document.createElement("a");l.innerHTML="View Details",l.href=DBHelper.urlForRestaurant(e),s.append(l);const i=document.createElement("button");return i.id="fav"+e.id,i.innerHTML=" â˜†",getRestaurantfavStatus(e.id).then(e=>{e?(s.style.borderColor="#c22c2c",i.className="checked"):(s.style.borderColor="#ccc",i.className="")}),s.append(i),loadImage=((e,t)=>{(a=document.getElementById(t)).src=DBHelper.imageUrlForRestaurant(e),a.srcset=`images/${e.id}-400small.jpg 480w,images/${e.id}-600medium.jpg 600w`,a.sizes="(max-width: 600px) 60vw,(min-width: 601px) 50vw",a.alt="showing restaurant is "+e.name+" and cuisine type is "+e.cuisine_type}),s}),updateSelectedRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,a=t.selectedIndex,n=e[s].value,o=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML(),afterUpdate(t))})}),afterUpdate=(e=>{console.log("afterUpdate"),e.forEach(e=>{let t=e;image=document.getElementById("image"+e.id),image.src=DBHelper.imageUrlForRestaurant(t),image.alt="showing restaurant is "+t.name+" and cuisine type is "+t.cuisine_type,image.srcset=`images/${t.id}-400small.jpg 480w,images/${t.id}-600medium.jpg 600w`,image.sizes="(max-width: 600px) 60vw,(min-width: 601px) 50vw"})}),addFavorite=(e=>{fetch(`http://localhost:1337/restaurants/${e}/`,{method:"PUT",body:JSON.stringify({is_favorite:!0}),headers:{"Content-Type":"application/json"}}).then(e=>(console.log("response status:",e),e.json())).then(e=>{console.log("response status:",e.is_favorite)})}),removeFavorite=(e=>{fetch(`http://localhost:1337/restaurants/${e}/`,{method:"PUT",body:JSON.stringify({is_favorite:!1}),headers:{"Content-Type":"application/json"}}).then(e=>(console.log("response status:",e),e.json())).then(e=>{console.log("response status:",e.is_favorite)})}),window.addEventListener("click",e=>{let t=e.target.id,s=e.target,a=t.replace(/^\D+/g,"");t.includes("fav")&&!s.classList.contains("checked")?(console.log("clicked",e),addFavorite(a),s.classList.toggle("checked"),changeFavRestaurantBorder(!0,a-1)):t.includes("fav")&&s.classList.contains("checked")&&(removeFavorite(a),s.classList.toggle("checked"),changeFavRestaurantBorder(!1,a-1))});